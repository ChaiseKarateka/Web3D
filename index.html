  <!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>TP Web3D</title>
    
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@v6.1.1/dist/aframe-extras.controls.min.js"></script>

  </head>
  
  <body style="margin:0; overflow:hidden;">
    
    <a-scene physics="debug: true">
      
      <a-assets>
        <img id="sky" src="sky.jpg">
        <img id="grass" src="grass.jpg">
      </a-assets>
      
      <a-sky src="#sky"></a-sky>
      
      <a-plane position="0 0 0" rotation="-90 0 0" width="400" height="400" src="#grass" static-body></a-plane>
      
      <!-- Cube joueur -->
      <a-box id="player" 
             color="red" 
             depth="1" height="1" width="1" 
             position="0 0.5 0" 
             dynamic-body
             wasd-controls="acceleration: 20">
      </a-box>

      <a-entity id="rig" orbit-controls="
          target: #player;
          enableDamping: true;
          dampingFactor: 0.1;
          minDistance: 3;
          maxDistance: 10;
          minPolarAngle: 0.1;   /* empêche de passer sous le sol */
          maxPolarAngle: 1.57;  /* ≈ 90° en radians, empêche de monter trop haut */
          rotateSpeed: 0.3;
          zoomSpeed: 0.5;">
        <a-camera></a-camera>
      </a-entity>
      
      <script>
        AFRAME.registerComponent('jump-control', {
          init: function () {
            this.canJump = false;
            window.addEventListener('keydown', e => {
              if (e.code === 'Space' && this.canJump) {
                this.el.body.velocity.y = 5;  // force du saut
                this.canJump = false;
              }
            });

            this.el.addEventListener('collide', e => {
              if (e.detail.body.el.tagName === 'A-PLANE') {
                this.canJump = true;
              }
            });
          }
        });

        document.querySelector('#player').setAttribute('jump-control', '');
      </script>
    </a-scene>
  </body>
</html>
